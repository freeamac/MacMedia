{% extends "base.html" %}
{% import "bootstrap5/form.html" as wtf %}

{% block title %}Modify {{ media_str.upper() }} Information{% endblock %}

{% block page_content %}
<div class="page-header">
	<h1>Modify {{ media_str.upper() }} Information</h1>
</div>

<div class="container">
  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <div class="row row-cols-auto">
        <div class="col-sm-2">
          <b>Title:</b>
        </div>
        <div class="col">
          {{ form.title }}
        </div>
      </div>
      <div class="row row-cols-auto top10">
        <div class="col-sm-2">
          <b>Main Artist:</b>
        </div>
        <div class="col">
          {{ form.main_artist}}
        </div>
      </div>
      <hr class="hr-sm" style="width:75%;text-align:left;margin-left:0;height:20">
      <div id="additional_artists">
        {% for additional_artist in form.additional_artists %}
          <div class="row row-cols-auto removeclass{{ loop.index }}" id="artist_row_{{ loop.index }}">
            <div class="col">
              <b>Particle:</b>
            </div>
            <div class="col">
              {{ additional_artist.additional_artist_particle }}
            </div>
            <div class="col">
              <b>Additional Artist:</b>
            </div>
            <div class="col">
              {{ additional_artist.additional_artist }}
            </div>
            <div class="col-sm-1 minus_button_{{ loop.index }}">
              <div class="btn-group" role="group">
                <button class="btn btn-danger" type="button" onclick="remove_additional_artist_fields({{ loop.index }});"> <span class="bi bi-dash-lg" aria-hidden="true"></span></button>
              </div>
            </div>
            {% if loop.last %}
          </div>
      </div>
          
          <div class="row" id="plus_button">
            <div class="col-sm-1 plus_button_{{ loop.index }}">
              <div class="btn-group" role="group">
                <button class="btn btn-success" type="button"  onclick="additional_artist_fields({{ loop.index }});"> <span class="bi bi-plus" aria-hidden="true"></span> </button>
              </div>
            </div>
          </div>
          {% else %}
          </div>
          {% endif %}

        {% endfor %}

      <hr class="hr-sm" style="width:75%;text-align:left;margin-left:0">
      <div class="row row-cols-auto top20">
        <div class="col">
          <b>Mixer:</b>
        </div>
        <div class="col">
          {{ form.mixer }}
        </div>
      </div>
      <div class="row row-cols-auto top20">
        <div class="col">
          <b>Classical Comp. 1:</b>
        </div>
        <div class="col">
          {{ form.classical_composer_1 }}
        </div>
      </div>
      <div class="row row-cols-auto">
        <div class="col">
          <b>Classical Comp. 2:</b>
        </div>
        <div class="col">
          {{ form.classical_composer_2 }}
        </div>
      </div>
      <div class="row row-cols-auto top20">
        <div class="col">
          <b>Year Released:</b>
        </div>
        <div class="col">
          {{ form.year }}
        </div>
      </div>
    
      <div class="row row-cols-auto top20">
        <div class="col">
          <input type="submit" name="save" value="Save">
        </div>
        <div class="col">
          <input type="submit" name="save_and_modify_tracks" value="Save & Modify Tracks">
        </div>
        <div class="col">
          <input type="submit" name="modify_tracks" value="Modify Tracks">
        </div>
        <div class="col">
          <input type="submit" name="cancel" value="Cancel">
        </div>
      </div>
    </form>

</div>
{% endblock %}

{% block scripts %}
{{ super() }}
{{ pagedown.include_pagedown() }}

<script nonce="{{ csp_nonce() }}">
  function additional_artist_fields(index) {
 
    var next_index = index + 1
    $('.plus_button_'+index).remove();
    var objTo = document.getElementById('additional_artists');
    var additionalArtistRow = document.createElement("div");
	  additionalArtistRow.setAttribute("class", "row row-cols-auto removeclass"+next_index);
    additionalArtistRow.setAttribute("id", "artist_row_"+next_index)
    additionalArtistRow.innerHTML = '\
        <div class="col">\
        <b>Particle:</b>\
      </div>\
      <div class="col">\
        <input id="additional_artists-'+next_index+'-additional_artist_particle" maxlength="20" minlength="0" name="additional_artists-'+next_index+'-additional_artist_particle" type="text" value="">\
      </div>\
      <div class="col">\
        <b>Additional Artist:</b>\
      </div>\
      <div class="col">\
        <input id="additional_artists-'+next_index+'-additional_artist" maxlength="40" minlength="0" name="additional_artists-'+next_index+'-additional_artist" type="text" value="">\
      </div>\
      <div class="col-sm-1 minus_button_'+next_index+'">\
        <div class="btn-group" role="group">\
          <button class="btn btn-danger" type="button" onclick="remove_additional_artist_fields('+next_index+');"> <span class="bi bi-dash-lg" aria-hidden="true"></span></button>\
        </div>\
      </div>\
    ';
    objTo.append(additionalArtistRow)

    // Update the plus button with a new index
    $('.plus_button_'+index).remove();
    objTo = document.getElementById("plus_button")
    var plusButtonIcon = document.createElement("div");
    plusButtonIcon.setAttribute("class", "plus_button_"+next_index)
    plusButtonIcon.innerHTML ='\
      <div class="btn-group" role="group">\
        <button class="btn btn-success" type="button"  onclick="additional_artist_fields('+next_index+');"> <span class="bi bi-plus" aria-hidden="true"></span> </button>\
      </div>\
    </div>\
    ';
    objTo.append(plusButtonIcon)
  }

  function remove_additional_artist_fields(rid) {
	  $('.removeclass'+rid).remove();
  }
</script>

{% endblock %}
